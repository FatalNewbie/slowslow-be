<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="${post.title} + ' - 정처기info'">Post Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <h1 class="text-center my-4">정처기info</h1>
    <h3 class="text-center my-4" th:text="${board.boardTitle}"></h3>
    <p class="text-center my-4" th:text="${board.description}"></p>
    <h5><a th:href="@{/boards/{boardId}(boardId=${boardId})}"><- 게시글 목록으로</a></h5>
    <div class="row">
        <div class="col-md-8 mx-auto rounded border p-4 m-4">
            <div class="d-flex justify-content-between">
                <h2 th:text="${post.title}">제목</h2>
                <div>
                    <a th:href="@{/boards/{boardId}/{postId}/edit(boardId=${boardId}, postId=${post.postId})}" class="btn btn-primary btn-sm">수정</a>
                    <form th:action="@{/boards/{boardId}/{postId}/delete(boardId=${boardId}, postId=${post.postId})}" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('삭제하시겠습니까?')">삭제</button>
                    </form>
                </div>
            </div>
            <p><strong>작성자:</strong> <span th:text="${post.author}">작성자</span></p>
            <p><strong>작성 시간:</strong> <span th:text="${#dates.format(post.createdAt, 'yyyy-MM-dd HH:mm:ss')}">작성 시간</span></p>
            <div class="mb-3">
                <p th:text="${post.content}">게시글 내용</p>
            </div>

            <!-- 댓글 섹션 -->
            <div class="comments mt-4">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>댓글</h3>
                    <a href="#" class="btn btn-primary" th:href="@{/boards/{boardId}/{postId}(boardId=${boardId}, postId=${postId}, sortOrder='desc')}">최신순</a>
                </div>
                <div th:each="comment : ${comments}">
                    <div class="comment mb-2 p-3 border">
                        <div class="d-flex justify-content-between">
                            <div>
                                <p><strong>작성자:</strong> <span th:text="${comment.author}"></span></p>
                                <p><strong>내용:</strong> <span th:text="${comment.content}"></span></p>
                            </div>
                            <div class="d-flex align-items-center">
                                <p class="me-3"><strong>작성 시간:</strong> <span th:text="${#dates.format(comment.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></span></p>
                                <div class="d-flex">
                                    <!-- 수정 버튼 -->
                                    <a href="#" class="btn btn-primary btn-sm me-2" th:onclick="'toggleEditForm(' + ${comment.commentId} + ')'">수정</a>
                                    <!-- 삭제 버튼 -->
                                    <form th:action="@{/boards/{boardId}/{postId}/deleteComment(boardId=${boardId}, postId=${post.postId}, commentId=${comment.commentId})}" method="post" style="display:inline;">
                                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('삭제하시겠습니까?')">삭제</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <!-- 수정 폼 -->
                        <div th:id="'editForm-' + ${comment.commentId}" class="edit-form mb-2 p-3 border" style="display: none;">
                        <form th:action="@{/boards/{boardId}/{postId}/editComment/{commentId}(boardId=${boardId}, postId=${post.postId}, commentId=${comment.commentId})}" method="post">
                                <input type="text" name="author" th:value="${comment.author}" class="form-control mb-2" required>
                                <textarea name="content" class="form-control mb-2" required th:text="${comment.content}"></textarea>
                                <button type="submit" class="btn btn-primary">수정 완료</button>
                            </form>
                        </div>
                    </div>
                </div>
                <form method="post" th:action="@{/boards/{boardId}/{postId}/addComment(boardId=${boardId}, postId=${post.postId})}" class="mb-4">
                    <input type="text" name="author" placeholder="작성자" class="form-control mb-2" required>
                    <textarea name="content" placeholder="내용" class="form-control mb-2" required></textarea>
                    <button type="submit" class="btn btn-primary">댓글 작성</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>

    function toggleEditForm(commentId) {
        console.log("Clicked commentId:", commentId); // 해당 댓글의 ID를 콘솔에 출력
        // 모든 수정 폼 숨기기
        var forms = document.getElementsByClassName('edit-form');
        for (var i = 0; i < forms.length; i++) {
            forms[i].style.display = 'none';
        }

        // 클릭된 수정 버튼에 해당하는 댓글의 수정 폼 토글
        var form = document.getElementById('editForm-' + commentId);
        if (form.style.display === 'none') {
            form.style.display = 'block';
        } else {
            form.style.display = 'none';
        }
    }
</script>
</body>
</html>